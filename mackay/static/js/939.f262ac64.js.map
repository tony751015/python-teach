{"version":3,"file":"js/939.f262ac64.js","mappings":"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","sources":["webpack://wound-chat/../../../src/components/VSubheader/VSubheader.ts","webpack://wound-chat/./src/views/ChatList.vue","webpack://wound-chat/src/views/ChatList.vue","webpack://wound-chat/./src/views/ChatList.vue?dc14","webpack://wound-chat/./src/views/ChatList.vue?516f"],"sourcesContent":["// Styles\nimport './VSubheader.sass'\n\n// Mixins\nimport Themeable from '../../mixins/themeable'\nimport mixins from '../../util/mixins'\nimport { getSlot } from '../../util/helpers'\n\n// Types\nimport { VNode } from 'vue'\n\nexport default mixins(\n  Themeable\n  /* @vue/component */\n).extend({\n  name: 'v-subheader',\n\n  props: {\n    inset: Boolean,\n  },\n\n  render (h): VNode {\n    return h('div', {\n      staticClass: 'v-subheader',\n      class: {\n        'v-subheader--inset': this.inset,\n        ...this.themeClasses,\n      },\n      attrs: this.$attrs,\n      on: this.$listeners,\n    }, getSlot(this))\n  },\n})\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('v-app-bar',{attrs:{\"color\":\"main-green\",\"elevation\":\"0\",\"dense\":\"\"}},[_c('v-responsive',{staticClass:\"d-sm-none\"},[_c('v-app-bar-nav-icon')],1),_c('img',{staticClass:\"main-logo\",attrs:{\"src\":require(\"../assets/logo_dr.png\"),\"alt\":\"logo\"}}),_c('v-spacer',[[_c('v-tabs',{attrs:{\"align-with-title\":\"\",\"background-color\":\"transparent\"}})]],2),_c('v-menu',{attrs:{\"offset-y\":\"\"},scopedSlots:_vm._u([{key:\"activator\",fn:function({ on, attrs }){return [_c('v-btn',_vm._g(_vm._b({staticClass:\"dropdown-btn\",attrs:{\"rounded\":\"\",\"color\":\"normal\"}},'v-btn',attrs,false),on),[_c('v-avatar',{attrs:{\"size\":\"30\"}},[_c('v-img',{attrs:{\"src\":_vm.thumb_avatar}})],1),_c('span',{staticClass:\"ml-2\"},[_vm._v(_vm._s(_vm.username))]),_c('v-icon',{attrs:{\"right\":\"\"}},[_vm._v(\"mdi-chevron-down\")])],1)]}}])},[_c('v-list',{attrs:{\"dense\":\"\"}},[_c('v-list-item',[_c('v-list-item-title',{staticClass:\"logoutBtn\",on:{\"click\":_vm.logout}},[_vm._v(\"log out\")])],1)],1)],1)],1),_c('v-container',{staticClass:\"fill-height\",attrs:{\"fluid\":\"\"}},[_c('v-row',[_c('v-col',{staticClass:\"chat-list-section\",attrs:{\"cols\":\"8\"}},[_c('v-text-field',{attrs:{\"prepend-icon\":\"mdi-magnify\",\"label\":\"Search for a patient\",\"dense\":\"\",\"outlined\":\"\",\"color\":\"main-green\",\"placeholder\":\"Search for a patient\",\"hide-details\":\"\"},model:{value:(_vm.searchQuery),callback:function ($$v) {_vm.searchQuery=$$v},expression:\"searchQuery\"}}),_c('v-list',[_c('v-subheader',[_vm._v(\"Patient census: \"+_vm._s(_vm.patientCount))]),(!_vm.preloading)?[_vm._l((_vm.visiblePatients),function(patient){return _c('v-list-item',{key:patient.id,staticClass:\"patient-item\",class:{ 'outlined': _vm.highlightedPatientId === patient.user_id },on:{\"click\":function($event){return _vm.selectPatient(patient.user_id)}}},[_c('v-list-item-avatar',{attrs:{\"size\":\"56\"}},[_c('v-img',{attrs:{\"src\":patient.user_avatar || require('@/assets/user.png')}})],1),_c('v-list-item-content',[_c('v-list-item-title',[_vm._v(\" \"+_vm._s(patient.user_name)+\" \"),_c('span',{staticClass:\"grey--text text--lighten-1 font-small\"},[_vm._v(_vm._s('(' + patient.user_id + ')'))])]),_c('v-list-item-subtitle',[(\r\n                        patient.last_message &&\r\n                        patient.last_message.content_type === 'text'\r\n                      )?_c('span',[_vm._v(\" \"+_vm._s(patient.last_message.content)+\" \")]):(\r\n                        patient.last_message &&\r\n                        patient.last_message.content_type === 'image'\r\n                      )?_c('span',[_vm._v(\" 傳送了一張圖片 \"),_c('v-btn',{staticClass:\"px-1\",attrs:{\"outlined\":\"\",\"color\":\"main-green\",\"small\":\"\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.openImagePopup(\r\n                          `${_vm.SERVER_PATH}media/${patient.last_message.media_url}`\r\n                        )}}},[_c('v-icon',{staticClass:\"font-normal\"},[_vm._v(\"mdi-magnify\")]),_vm._v(\" photo \")],1)],1):_c('span',[_vm._v(\"no message\")])])],1),_c('v-list-item-action',[_c('v-btn',{staticClass:\"px-1\",attrs:{\"outlined\":\"\",\"elevation\":\"0\",\"color\":\"main-green\",\"small\":\"\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.goChatroom(patient)}}},[_vm._v(\"Open Chat \")])],1),_c('v-list-item-action',[_c('v-btn',{attrs:{\"fab\":\"\",\"elevation\":\"0\",\"color\":patient.pin ? 'main-green' : ''},on:{\"click\":function($event){$event.stopPropagation();return _vm.togglePin(patient)}}},[_c('v-icon',{attrs:{\"color\":patient.pin ? 'white' : ''}},[_vm._v(\"mdi-pin\")])],1)],1)],1)}),_c('infinite-loading',{attrs:{\"identifier\":_vm.infiniteId,\"spinner\":\"bubbles\",\"direction\":\"bottom\"},on:{\"infinite\":_vm.loadMorePatients}},[_c('div',{staticClass:\"infini-note grey--text text--lighten-1 font-small\",attrs:{\"slot\":\"no-more\"},slot:\"no-more\"},[_vm._v(\"No more data\")]),_c('div',{staticClass:\"infini-note grey--text text--lighten-1 font-small\",attrs:{\"slot\":\"no-results\"},slot:\"no-results\"},[_vm._v(\"No results found\")])])]:_vm._e()],2)],1),_c('wound-photos',{attrs:{\"albums\":_vm.albums,\"current-album\":_vm.currentAlbum,\"selected-patient-id\":_vm.selectedPatientId},on:{\"update:currentAlbum\":function($event){_vm.currentAlbum=$event},\"update:current-album\":[function($event){_vm.currentAlbum=$event},_vm.updateCurrentAlbum]}})],1)],1),_c('ImagePopup',{key:`imgpop-${_vm.popImgKey}`,attrs:{\"visible\":_vm.imageDialog,\"image\":_vm.imageSrc},on:{\"close\":_vm.closeImagePopup}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n<div>\r\n  <!-- Topbar 區域 -->\r\n  <v-app-bar color=\"main-green\" elevation=\"0\" dense>\r\n    <v-responsive class=\"d-sm-none\">\r\n      <v-app-bar-nav-icon></v-app-bar-nav-icon>\r\n    </v-responsive>\r\n    \r\n    <img src=\"../assets/logo_dr.png\" class=\"main-logo\" alt=\"logo\">\r\n    <v-spacer>\r\n      <template>\r\n        <v-tabs align-with-title background-color=\"transparent\">\r\n        </v-tabs>\r\n      </template>\r\n    </v-spacer>\r\n    <v-menu offset-y>\r\n      <template v-slot:activator=\"{ on, attrs }\">\r\n        <v-btn class=\"dropdown-btn\" v-bind=\"attrs\" v-on=\"on\" rounded color=\"normal\">\r\n          <v-avatar size=\"30\">\r\n            <v-img :src=\"thumb_avatar\"></v-img>\r\n          </v-avatar>\r\n          <span class=\"ml-2\">{{ username }}</span>\r\n          <v-icon right>mdi-chevron-down</v-icon>\r\n        </v-btn>\r\n      </template>\r\n      <v-list dense>\r\n        <v-list-item>\r\n          <v-list-item-title class=\"logoutBtn\" @click=\"logout\">log out</v-list-item-title>\r\n        </v-list-item>\r\n      </v-list>\r\n    </v-menu>\r\n  </v-app-bar>\r\n  \r\n  <!-- 主要內容區塊 -->\r\n  <v-container fluid class=\"fill-height\">\r\n    <v-row>\r\n      <!-- 左側：用戶列表 -->\r\n      <v-col cols=\"8\" class=\"chat-list-section\">\r\n        <!-- 搜尋區域 -->\r\n        <v-text-field\r\n          v-model=\"searchQuery\"\r\n          prepend-icon=\"mdi-magnify\"\r\n          label=\"Search for a patient\"\r\n          dense\r\n          outlined\r\n          color=\"main-green\"\r\n          placeholder=\"Search for a patient\"\r\n          hide-details\r\n        ></v-text-field>\r\n        \r\n        <v-list>\r\n          <v-subheader>Patient census: {{ patientCount }}</v-subheader>\r\n            <template v-if=\"!preloading\">\r\n              <v-list-item\r\n                v-for=\"patient in visiblePatients\"\r\n                :key=\"patient.id\"\r\n                class=\"patient-item\"\r\n                @click=\"selectPatient(patient.user_id)\"\r\n                :class=\"{ 'outlined': highlightedPatientId === patient.user_id }\"\r\n              >\r\n                <v-list-item-avatar size=\"56\">\r\n                  <v-img :src=\"patient.user_avatar || require('@/assets/user.png')\"></v-img>\r\n                </v-list-item-avatar>\r\n            \r\n                <v-list-item-content>\r\n                  <v-list-item-title>\r\n                    {{ patient.user_name }}\r\n                    <span class=\"grey--text text--lighten-1 font-small\">{{ '(' + patient.user_id + ')'}}</span>\r\n                  </v-list-item-title>\r\n                  <v-list-item-subtitle>\r\n                    <span\r\n                      v-if=\"\r\n                        patient.last_message &&\r\n                        patient.last_message.content_type === 'text'\r\n                      \"\r\n                    >\r\n                      {{ patient.last_message.content }}\r\n                    </span>\r\n                    <span\r\n                      v-else-if=\"\r\n                        patient.last_message &&\r\n                        patient.last_message.content_type === 'image'\r\n                      \"\r\n                    >\r\n                      傳送了一張圖片\r\n                      <v-btn\r\n                        outlined\r\n                        color=\"main-green\"\r\n                        small\r\n                        class=\"px-1\"\r\n                        @click.stop=\"openImagePopup(\r\n                          `${SERVER_PATH}media/${patient.last_message.media_url}`\r\n                        )\"\r\n                      >\r\n                        <v-icon class=\"font-normal\">mdi-magnify</v-icon>\r\n                        photo\r\n                      </v-btn>\r\n                    </span>\r\n                    <span v-else>no message</span>\r\n                  </v-list-item-subtitle>\r\n                </v-list-item-content>\r\n                <v-list-item-action>\r\n                  <v-btn \r\n                    outlined\r\n                    elevation=\"0\"\r\n                    color=\"main-green\"\r\n                    small\r\n                    class=\"px-1\"\r\n                    @click.stop=\"goChatroom(patient)\"\r\n                  >Open Chat\r\n                    <!-- <v-icon>mdi-arrow-right-bold</v-icon> -->\r\n                  </v-btn>\r\n                </v-list-item-action>\r\n                <v-list-item-action>\r\n                  <v-btn \r\n                    fab \r\n                    elevation=\"0\"\r\n                    :color=\"patient.pin ? 'main-green' : ''\"\r\n                    @click.stop=\"togglePin(patient)\"\r\n                  >\r\n                    <v-icon :color=\"patient.pin ? 'white' : ''\">mdi-pin</v-icon>\r\n                  </v-btn>\r\n                </v-list-item-action>\r\n              </v-list-item>\r\n            \r\n              <infinite-loading \r\n                :identifier=\"infiniteId\"\r\n                @infinite=\"loadMorePatients\"\r\n                spinner=\"bubbles\"\r\n                direction=\"bottom\"\r\n              >\r\n                <div slot=\"no-more\" class=\"infini-note grey--text text--lighten-1 font-small\">No more data</div>\r\n                <div slot=\"no-results\" class=\"infini-note grey--text text--lighten-1 font-small\">No results found</div>\r\n              </infinite-loading>\r\n            </template>\r\n          \r\n        </v-list>\r\n      </v-col>\r\n\r\n      <!-- 右側：照片列表區域 -->\r\n      \r\n        <wound-photos\r\n          :albums=\"albums\"\r\n          :current-album.sync=\"currentAlbum\"\r\n          :selected-patient-id=\"selectedPatientId\"\r\n          @update:current-album=\"updateCurrentAlbum\"\r\n        ></wound-photos>\r\n      \r\n    </v-row>\r\n  </v-container>\r\n\r\n  <!-- 圖片彈出組件 -->\r\n  <ImagePopup\r\n    :key=\"`imgpop-${popImgKey}`\" \r\n    :visible=\"imageDialog\" \r\n    :image=\"imageSrc\" \r\n    @close=\"closeImagePopup\">\r\n  </ImagePopup>\r\n</div>\r\n</template>\r\n  \r\n<script>\r\n  import axios from 'axios';\r\n  import ImagePopup from '../components/ImagePopup.vue';\r\n  import WoundPhotos from '../components/WoundPhotos.vue';\r\n  import { mapMutations } from 'vuex';\r\n// import { reject, resolve } from 'core-js/fn/promise';\r\n  \r\n  export default {\r\n    components: {\r\n      ImagePopup,\r\n      WoundPhotos\r\n    },\r\n\r\n    created() {\r\n      this.initPatientsList();\r\n    },\r\n\r\n    data() {\r\n      return {\r\n        preloading: true,\r\n        username: '使用者',\r\n        thumb_avatar: '',\r\n        searchQuery: '',\r\n        imageDialog: false,\r\n        imageSrc: '',\r\n        popImgKey: 1,\r\n        patients: [],\r\n        patientCount: 0,\r\n        currentPage: 1,\r\n        pageSize: 1, // 每頁資料數量\r\n        infiniteId: +new Date(), // 確保重置 infinite-loading\r\n        pinnedPatients: [], // 存儲已經 pin 的病患 ID\r\n        selectedPatientId: -1, // 初始化為 -1\r\n        highlightedPatientId: null, // 用於追蹤當前選擇的病患\r\n        albums: [], // 初始化 albums 為空陣列\r\n        currentAlbum: 0, // 初始化 currentAlbum\r\n        dontRun: false\r\n      };\r\n    },\r\n    computed: {\r\n      filteredPatients() {\r\n        // 根據使用者輸入的搜尋字串過濾病患列表\r\n        // 如果病患的名字或 ID 包含搜尋字串，則保留該病患\r\n        return this.patients.filter(patient => \r\n            patient.user_name.includes(this.searchQuery) || \r\n            patient.user_id.toString().includes(this.searchQuery)\r\n        );\r\n      },\r\n      visiblePatients() {\r\n        return this.filteredPatients.filter(patient => !patient.is_superuser);\r\n      }\r\n    },\r\n    methods: {\r\n      openImagePopup(imageUrl) {\r\n        console.log('openImagePopup', imageUrl);\r\n        this.imageSrc = imageUrl;\r\n        this.imageDialog = true;\r\n        this.popImgKey += 1;\r\n      },\r\n      closeImagePopup() {\r\n        this.imageDialog = false;\r\n        this.imageSrc = '';\r\n        this.popImgKey += 1;\r\n      },\r\n      initPatientsList() {\r\n        axios.put('http://127.0.0.1:8000/api/chat/room', {\r\n          user_id: this.userProfile.id,\r\n          page: this.currentPage,\r\n          size: this.pageSize\r\n        })\r\n        .then(response => {\r\n          console.log(response.data.results);\r\n          if (response.data.results.length) {\r\n            this.patients.push(...response.data.results);\r\n            this.currentPage += 1;\r\n            this.preloading = false;\r\n            this.updatePatientCount(); // 更新 patientCount\r\n          } else {\r\n            this.preloading = true;\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"Error loading more patients:\", error);\r\n          this.updateAlert({\r\n            show: true,\r\n            status: 'error',\r\n            message: 'Opps! Something Wrong'\r\n          });\r\n          this.preloading = false;\r\n        });\r\n      },\r\n      loadMorePatients($state) {\r\n        if (!this.preloading) {\r\n          console.log(\"Loading more patients...\");\r\n          axios.put('http://127.0.0.1:8000/api/chat/room', {\r\n            user_id: this.userProfile.id,\r\n            page: this.currentPage,\r\n            size: this.pageSize\r\n          })\r\n          .then(response => {\r\n            console.log(response.data.results);\r\n            if (response.data.results.length) {\r\n              this.patients.push(...response.data.results);\r\n              this.currentPage += 1;\r\n              $state.loaded();\r\n              this.updatePatientCount(); // 更新 patientCount\r\n              // console.log(\"patients.\", JSON.stringify(this.patients));\r\n            } else {\r\n              $state.complete();\r\n              if (!this.dontRun) {\r\n                this.updateBanForSuperusers(); // 確保資料完整下載完後再執行\r\n                this.dontRun = true;\r\n              }\r\n            }\r\n          })\r\n          .catch(error => {\r\n            console.error(\"Error loading more patients:\", error);\r\n            this.updateAlert({\r\n              show: true,\r\n              status: 'error',\r\n              message: 'Opps! Something Wrong'\r\n            });\r\n            $state.complete();\r\n          });\r\n        }\r\n      },\r\n\r\n      togglePin(patient) {\r\n        const newPinState = !patient.pin;\r\n        patient.pin = newPinState;\r\n        axios.put('http://127.0.0.1:8000/api/chat/update_pin', {\r\n          user_id: this.userProfile.id,\r\n          pin: newPinState,\r\n          room_path: patient.room_path\r\n        })\r\n        .then(() => {\r\n          // if (newPinState) {\r\n          //   this.updateAlert({\r\n          //     show: true,\r\n          //     status: 'success',\r\n          //     message: 'Item pinned!'\r\n          //   });\r\n          // } else {\r\n          //   this.updateAlert({\r\n          //     show: true,\r\n          //     status: 'success',\r\n          //     message: 'Item unpinned!'\r\n          //   });\r\n          // }\r\n          this.startReloadPatientData();\r\n        })\r\n        .catch(error => {\r\n          console.error(\"Error updating pin state:\", error);\r\n        });\r\n      },\r\n\r\n      async startReloadPatientData() {\r\n        await this.reloadPatients();\r\n        await this.initPatientsList();\r\n      },\r\n\r\n      reloadPatients() {\r\n        // this.infiniteId += 1; // 重置 infinite-loading\r\n        return new Promise((resolve) => {\r\n          this.currentPage = 1;\r\n          this.patients = [];\r\n          this.preloading = true;\r\n          resolve();\r\n        })\r\n      },\r\n\r\n      selectPatient(userId) {\r\n        this.selectedPatientId = userId;\r\n        this.highlightedPatientId = userId;\r\n        // 確保 selectedPatientId 的變化能夠被 WoundPhotos.vue 監聽到\r\n      },\r\n      // reloadPatients() {\r\n      //   // this.infiniteId += 1; // 重置 infinite-loading\r\n      //   this.currentPage = 1;\r\n      //   this.patients = [];\r\n      //   this.preloading = true;\r\n      //   this.initPatientsList();\r\n\r\n      //   const process = new Promise((resolve, reject) => {\r\n      //     this.currentPage = 1;\r\n      //     this.patients = [];\r\n      //     this.preloading = true;\r\n\r\n      //     return resolve(this.preloading);\r\n      //   });\r\n\r\n      //   process.then((value) => {\r\n      //     if (value) {\r\n      //       this.initPatientsList();\r\n      //     }\r\n      //   });\r\n      // }\r\n      updateCurrentAlbum(newAlbumIndex) {\r\n        this.currentAlbum = newAlbumIndex;\r\n      },\r\n      goChatroom(patient) {\r\n        console.log('goChatroom', patient);\r\n        this.UPDATE_USER_ID(patient.user_id);\r\n\r\n        // 取得 localStorage 中的 mackay\r\n        const mackayData = JSON.parse(localStorage.getItem('mackay') || '{}');\r\n        \r\n        // 更新 user_id\r\n        mackayData.room_path = patient.room_path;\r\n        mackayData.selectedId = patient.user_id;\r\n        \r\n        // 將更新後的物件存回 localStorage\r\n        localStorage.setItem('mackay', JSON.stringify(mackayData));\r\n\r\n        this.$router.push({ path: `/chat/${patient.room_path}` });\r\n      },\r\n      updatePatientCount() {\r\n        this.patientCount = this.visiblePatients.length;\r\n      },\r\n      updateBanForSuperusers() {\r\n        const roomPathsToBan = this.patients\r\n          .filter(patient => patient.is_superuser)\r\n          .map(patient => patient.room_path);\r\n\r\n        if (roomPathsToBan.length > 0) {\r\n          axios.put('http://127.0.0.1:8000/api/chat/update_ban', {\r\n            user_id: this.userProfile.id,\r\n            ban: true,\r\n            room_paths: roomPathsToBan\r\n          })\r\n          .then(() => {\r\n            this.startReloadPatientData();\r\n          })\r\n          .catch(error => {\r\n            console.error(\"Error updating ban state:\", error);\r\n          });\r\n        }\r\n      },\r\n      ...mapMutations(['UPDATE_USER_ID'])\r\n    },\r\n    mounted() {\r\n      // const userId = this.userProfile.id;\r\n      // axios.put('http://127.0.0.1:8000/api/chat/room', {\r\n      //   user_id: userId,\r\n      //   page: \"1\",\r\n      //   size: \"5\"\r\n      // })\r\n      // .then(response => {\r\n      //   this.patients = response.data.results;\r\n      //   this.patientCount = response.data.count;\r\n      // })\r\n      // .catch(error => {\r\n      //   console.error('Error fetching data:', error);\r\n      // });\r\n  \r\n      if (this.userProfile.name) {\r\n        this.username = this.userProfile.name;\r\n      }\r\n      if (this.userProfile.thumb) {\r\n        this.thumb_avatar = this.userProfile.thumb;\r\n      }\r\n    }\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .fill-height {\r\n    height: calc(100vh - 48px);\r\n    padding: unset;\r\n  }\r\n  .container.fill-height > .row{\r\n    height: 100%;\r\n  }\r\n  .chat-list-section {\r\n    border-right: 1px solid #ccc;\r\n    height: 100%;\r\n    overflow-y: auto;\r\n  }\r\n  .photo-section {\r\n    height: 100%;\r\n    overflow-y: auto;\r\n  }\r\n  .v-toolbar__content {\r\n    width: 100%;\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n  .main-logo {\r\n    height: 100%;\r\n    padding: 10px 0px;\r\n  }\r\n  .patient-item{\r\n    margin-bottom: 2px;\r\n  }\r\n  .patient-item:hover {\r\n    background-color: #d4eaed;\r\n    border-radius: 5px;\r\n  }\r\n  .logoutBtn {\r\n    cursor: pointer;\r\n    text-align: center;\r\n  }\r\n  .image-popup {\r\n    background-color: rgba(0, 0, 0, 0.8); \r\n    width: calc(9/12 * 100vw); \r\n    height: 100vh;\r\n    position: relative;\r\n  }\r\n  \r\n  .popup-img {\r\n    width: 100%;\r\n    height: auto;\r\n  }\r\n  \r\n  .close-btn {\r\n    position: absolute;\r\n    top: 10px;\r\n    right: 10px;\r\n    color: white;\r\n    z-index: 101;\r\n  }\r\n  .v-btn:before {\r\n  opacity: 0 !important;\r\n}\r\n\r\n.v-ripple__container {\r\n  opacity: 0 !important;\r\n}\r\n.infini-note {\r\n  margin-top: 15px;          \r\n}   \r\n.outlined {\r\n  outline: 2px solid #2D9CA0;\r\n  border-radius: 5px;\r\n}\r\n  </style>","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ChatList.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ChatList.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./ChatList.vue?vue&type=template&id=daeda704&scoped=true\"\nimport script from \"./ChatList.vue?vue&type=script&lang=js\"\nexport * from \"./ChatList.vue?vue&type=script&lang=js\"\nimport style0 from \"./ChatList.vue?vue&type=style&index=0&id=daeda704&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"daeda704\",\n  null\n  \n)\n\nexport default component.exports"],"names":["mixins","Themeable","extend","name","props","inset","Boolean","render","h","staticClass","class","this","themeClasses","attrs","$attrs","on","$listeners","getSlot","scopedSlots","_vm","fn","_c","model","value","searchQuery","$$v","expression","patient","user_avatar","stopPropagation","openImagePopup","SERVER_PATH","$event","_v","currentAlbum","updateCurrentAlbum","staticRenderFns","components","ImagePopup","WoundPhotos","created","initPatientsList","data","preloading","username","thumb_avatar","imageDialog","imageSrc","popImgKey","patients","patientCount","currentPage","pageSize","infiniteId","Date","pinnedPatients","selectedPatientId","highlightedPatientId","albums","dontRun","computed","filteredPatients","filter","user_name","includes","user_id","toString","visiblePatients","is_superuser","methods","imageUrl","console","log","closeImagePopup","axios","put","userProfile","id","page","size","then","response","results","length","push","updatePatientCount","catch","error","updateAlert","show","status","message","loadMorePatients","$state","loaded","complete","updateBanForSuperusers","togglePin","newPinState","pin","room_path","startReloadPatientData","reloadPatients","Promise","resolve","selectPatient","userId","newAlbumIndex","goChatroom","UPDATE_USER_ID","mackayData","JSON","parse","localStorage","getItem","selectedId","setItem","stringify","$router","path","roomPathsToBan","map","ban","room_paths","mapMutations","mounted","thumb","component"],"sourceRoot":""}