"use strict";(self["webpackChunkwound_chat"]=self["webpackChunkwound_chat"]||[]).push([[795],{1795:function(t,e,s){s.r(e),s.d(e,{default:function(){return U}});var a=s(9397),i=s(8920),o=s(7061),n=s(8212),r=s(4528),l=s(8137),c=s(9072),u=s(8528),h=s(4738),d=s(3711),p=s(9012),m=s(8917),g=s(9102),_=s(3462),P=s(7573),f=s(1002),b=s(2492),A=s(3219),v=s(8961),C=s(170),y=(0,v.A)(A.A).extend({name:"v-subheader",props:{inset:Boolean},render(t){return t("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},(0,C.$c)(this))}}),S=s(9591),w=s(7667),k=s(3184),I=function(){var t=this,e=t._self._c;return e(a.A,[e(i.A,{attrs:{color:"main-green",elevation:"0",dense:""}},[e("img",{staticClass:"main-logo",attrs:{src:s(5332),alt:"logo"}}),e(b.A,[[e(S.A,{attrs:{"align-with-title":"","background-color":"transparent"}})]],2),e(P.A,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(n.A,t._g(t._b({staticClass:"dropdown-btn",attrs:{rounded:"",color:"normal",small:"mobile"===t.getRwdType}},"v-btn",a,!1),s),[e(o.A,{attrs:{size:"mobile"!==t.getRwdType?30:20}},[e(h.A,{attrs:{src:t.thumb_avatar}})],1),e("span",{staticClass:"ml-2 d-none d-sm-block"},[t._v(t._s(t.username))]),e(u.A,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}])},[e(d.A,{attrs:{dense:""}},[e(p.A,{staticClass:"d-sm-none"},[e(_.UZ,{staticClass:"user-name"},[t._v(t._s(t.username))])],1),e(c.A,{staticClass:"d-sm-none"}),e(p.A,{on:{click:t.logout}},[e(_.UZ,{staticClass:"logoutBtn"},[t._v("log out")])],1)],1)],1)],1),e(l.A,{staticClass:"fill-height",attrs:{fluid:""}},[e(f.A,[e(r.A,{staticClass:"chat-list-section",attrs:{cols:12,md:8}},[e(k.A,{staticClass:"w-100",attrs:{flat:"",dense:""}},[e(w.A,{attrs:{"prepend-inner-icon":"mdi-magnify",label:"Search for a patient",dense:"",outlined:"",color:"main-green",placeholder:"Search for a patient","hide-details":""},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}})],1),e(d.A,[e(y,[t._v("Total: "+t._s(t.patientCount))]),t.preloading?t._e():[t._l(t.visiblePatients,(function(a){return e(p.A,{key:a.id,staticClass:"patient-item px-3",class:{outlined:t.highlightedPatientId===a.user_id},on:{click:function(e){t.selectPatient(a),t.togglePhotoSection()}}},[e(g.A,{attrs:{size:"mobile"===t.getRwdType?30:45}},[e(h.A,{attrs:{src:a.user_avatar||s(4441)}})],1),e(_.pr,[e(_.UZ,{staticClass:"font-weight-bold"},[t._v(" "+t._s(a.user_name)+" "),e("span",{staticClass:"grey--text text--lighten-1 font-small"},[t._v(t._s("("+a.user_id+")"))])]),e(_.w,[a.last_message&&"text"===a.last_message.content_type?e("span",[t._v(" "+t._s(a.last_message.content)+" ")]):a.last_message&&"image"===a.last_message.content_type?e("span",[t._v(" send a photo ")]):e("span",[t._v("no message")])])],1),e(m.A,[e(n.A,{class:["chat-btn",{"mobile-chat-btn":t.$vuetify.breakpoint.smAndDown}],attrs:{outlined:"",elevation:"0",color:"main-green",small:"",fab:"desktop"!==t.getRwdType},on:{click:function(e){return e.stopPropagation(),t.goChatroom(a)}}},["desktop"!==t.getRwdType?e("div",{staticClass:"d-flex flex-column align-center"},[e(u.A,{staticClass:"mb-1",attrs:{size:"22"}},[t._v("mdi-chat-processing-outline")])],1):[t._v(" Open Chat ")]],2)],1),e(m.A,{staticClass:"ml-2"},[e(n.A,{attrs:{small:"",fab:"",elevation:"0",color:a.pin?"main-green":""},on:{click:function(e){return e.stopPropagation(),t.togglePin(a)}}},[e(u.A,{attrs:{color:a.pin?"white":""}},[t._v("mdi-pin")])],1)],1)],1)})),e("infinite-loading",{attrs:{identifier:t.infiniteId,spinner:"bubbles",direction:"bottom"},on:{infinite:t.loadMorePatients}},[e("div",{staticClass:"infini-note grey--text text--lighten-1 font-small",attrs:{slot:"no-more"},slot:"no-more"},[t._v("No more data")]),e("div",{staticClass:"infini-note grey--text text--lighten-1 font-small",attrs:{slot:"no-results"},slot:"no-results"},[t._v("No results found")])])]],2)],1),e("wound-photos",{staticClass:"photo-section",class:{"photo-section--mobile":t.$vuetify.breakpoint.smAndDown,"photo-section--open":t.isPhotoSectionOpen&&t.$vuetify.breakpoint.smAndDown},attrs:{albums:t.albums,"current-album":t.currentAlbum,"selected-patient-id":t.selectedPatientId,"selected-chatroom":t.selectedChatroom},on:{"update:currentAlbum":function(e){t.currentAlbum=e},"update:current-album":[function(e){t.currentAlbum=e},t.updateCurrentAlbum]}})],1),t.$vuetify.breakpoint.smAndDown&&t.isPhotoSectionOpen?e(n.A,{staticClass:"floating-close-btn",attrs:{fab:"",color:"main-green",elevation:"2"},on:{click:t.togglePhotoSection}},[e(u.A,{attrs:{color:"white"}},[t._v("mdi-close")])],1):t._e()],1),e("ImagePopup",{key:`imgpop-${t.popImgKey}`,attrs:{visible:t.imageDialog,image:t.imageSrc},on:{close:t.closeImagePopup}})],1)},R=[],E=(s(4114),s(4335)),D=s(422),T=s(7672),x=s(5353),O={components:{ImagePopup:D.A,WoundPhotos:T.A},created(){this.initPatientsList(),document.body.classList.add("disable-scroller"),document.documentElement.style.overflow="hidden"},data(){return{preloading:!0,username:"使用者",thumb_avatar:"",searchQuery:"",imageDialog:!1,imageSrc:"",popImgKey:1,patients:[],patientCount:0,currentPage:1,pageSize:1,infiniteId:+new Date,pinnedPatients:[],selectedPatientId:-1,selectedChatroom:"noSelected",highlightedPatientId:null,albums:[],currentAlbum:0,dontRun:!1,isPhotoSectionOpen:!1}},computed:{filteredPatients(){return this.patients.filter((t=>t.user_name.includes(this.searchQuery)||t.user_id.toString().includes(this.searchQuery)))},visiblePatients(){return this.filteredPatients.filter((t=>!t.ban))}},methods:{openImagePopup(t){console.log("openImagePopup",t),this.imageSrc=t,this.imageDialog=!0,this.popImgKey+=1},closeImagePopup(){this.imageDialog=!1,this.imageSrc="",this.popImgKey+=1},initPatientsList(){E.A.put(`${this.SERVER_PATH}api/chat/room`,{user_id:this.userProfile.id,page:this.currentPage,size:this.pageSize}).then((t=>{console.log(t.data.results),t.data.results.length?(this.patients.push(...t.data.results),this.currentPage+=1,this.preloading=!1,this.updatePatientCount()):this.preloading=!0})).catch((t=>{console.error("Error loading more patients:",t),this.updateAlert({show:!0,status:"error",message:"Opps! Something Wrong"}),this.preloading=!1}))},loadMorePatients(t){this.preloading||(console.log("Loading more patients..."),E.A.put(`${this.SERVER_PATH}api/chat/room`,{user_id:this.userProfile.id,page:this.currentPage,size:this.pageSize}).then((e=>{console.log(e.data.results),e.data.results.length?(this.patients.push(...e.data.results),this.currentPage+=1,t.loaded(),this.updatePatientCount()):(t.complete(),this.dontRun||(this.updateBanForSuperusers(),this.dontRun=!0))})).catch((e=>{console.error("Error loading more patients:",e),this.updateAlert({show:!0,status:"error",message:"Opps! Something Wrong"}),t.complete()})))},togglePin(t){const e=!t.pin;t.pin=e,E.A.put(`${this.SERVER_PATH}api/chat/update_pin`,{user_id:this.userProfile.id,pin:e,room_path:t.room_path}).then((()=>{this.startReloadPatientData()})).catch((t=>{console.error("Error updating pin state:",t)}))},async startReloadPatientData(){await this.reloadPatients(),await this.initPatientsList()},reloadPatients(){return new Promise((t=>{this.currentPage=1,this.patients=[],this.preloading=!0,t()}))},selectPatient(t){console.log("selectPatient",t),this.selectedPatientId=t.user_id,this.highlightedPatientId=t.user_id,this.selectedChatroom=t.room_path},updateCurrentAlbum(t){this.currentAlbum=t},goChatroom(t){console.log("goChatroom",t),this.UPDATE_USER_ID(t.user_id),this.UPDATE_CHAT_ROOM(t.room_path);const e=JSON.parse(localStorage.getItem("mackay")||"{}");e.room_path=t.room_path,e.selectedId=t.user_id,localStorage.setItem("mackay",JSON.stringify(e)),this.$router.push({path:`/chat/${t.room_path}`})},updatePatientCount(){this.patientCount=this.visiblePatients.length},updateBanForSuperusers(){const t=this.patients.filter((t=>t.is_superuser)).map((t=>t.room_path));t.length>0&&E.A.put(`${this.SERVER_PATH}api/chat/update_ban`,{user_id:this.userProfile.id,ban:!0,room_paths:t}).then((()=>{this.startReloadPatientData()})).catch((t=>{console.error("Error updating ban state:",t)}))},...(0,x.PY)(["UPDATE_USER_ID","UPDATE_CHAT_ROOM"]),togglePhotoSection(){this.isPhotoSectionOpen=!this.isPhotoSectionOpen},preventBackButton(){history.pushState(null,"",location.href),console.log("Back button navigation prevented in ChatList.")}},mounted(){this.userProfile.name&&(this.username=this.userProfile.name),this.userProfile.thumb&&(this.thumb_avatar=this.userProfile.thumb),history.pushState(null,"",location.href),window.addEventListener("popstate",this.preventBackButton)},destroyed(){document.body.classList.remove("disable-scroller"),document.documentElement.style.overflow="unset",window.removeEventListener("popstate",this.preventBackButton)}},$=O,B=s(845),L=(0,B.A)($,I,R,!1,null,"b87255ae",null),U=L.exports},4441:function(t,e,s){t.exports=s.p+"img/user.d9df2589.png"}}]);
//# sourceMappingURL=795.2855355d.js.map