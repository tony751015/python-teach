"use strict";(self["webpackChunkwound_chat"]=self["webpackChunkwound_chat"]||[]).push([[518],{8719:function(e,t,s){s.d(t,{A:function(){return p}});var a=s(5147),i=s(8560),o=s(5349),r=s(6582),l=function(){var e=this,t=e._self._c;return t(o.A,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(a.A,{attrs:{color:"point-1",elevation:"1"}},[t(i.OQ,{staticClass:"loading-text"},[e._v(" "+e._s(e.showText)+" "),t(r.A,{staticClass:"mb-0",attrs:{indeterminate:"",color:"main-green"}})],1)],1)],1)},n=[],c={props:{showText:String,active:Boolean},data(){return{dialog:this.active}}},d=c,u=s(845),h=(0,u.A)(d,l,n,!1,null,"10136c39",null),p=h.exports},5518:function(e,t,s){s.r(t),s.d(t,{default:function(){return ge}});var a=s(9397),i=s(8920),o=s(7061),r=s(8212),l=s(4528),n=s(8137),c=s(9072),d=s(8528),u=s(4738),h=s(3711),p=s(9012),m=s(3462),g=s(7573),f=s(1002),_=s(2492),v=s(9591),b=s(7667),y=s(3184),w=function(){var e=this,t=e._self._c;return t(a.A,[t(i.A,{attrs:{color:"main-green",elevation:"0",dense:""}},[t("img",{staticClass:"main-logo",attrs:{src:s(5332),alt:"logo"}}),e.userProfile.super_user?t(r.A,{staticClass:"ml-6 white--text d-md-block d-none",attrs:{text:""},on:{click:function(t){return e.goChatList()}}},[e._v(" My Patients ")]):e._e(),t(_.A,[[t(v.A,{attrs:{"align-with-title":"","background-color":"transparent"}})]],2),t(g.A,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(r.A,e._g(e._b({staticClass:"dropdown-btn",attrs:{rounded:"",color:"normal",small:"mobile"===e.getRwdType},on:{click:e.handleDropdownClick}},"v-btn",a,!1),s),[t(o.A,{attrs:{size:"mobile"!==e.getRwdType?30:20}},[t(u.A,{attrs:{src:e.thumb_avatar}})],1),t("span",{staticClass:"ml-2 d-none d-sm-block"},[e._v(e._s(e.username))]),t(d.A,{attrs:{right:""}},[e._v("mdi-chevron-down")])],1)]}}])},[t(h.A,{attrs:{dense:""}},[t(p.A,{staticClass:"d-sm-none"},[t(m.UZ,{staticClass:"user-name"},[e._v(e._s(e.username))])],1),t(c.A,{staticClass:"d-sm-none"}),t(p.A,{on:{click:e.logout}},[t(m.UZ,{staticClass:"logoutBtn"},[e._v("log out")])],1)],1)],1)],1),t(n.A,{staticClass:"fill-height",attrs:{fluid:""}},[t(f.A,[t(l.A,{staticClass:"chat-section",attrs:{cols:12,md:8}},[t(y.A,{staticClass:"w-100 searchChatToolBar",attrs:{flat:"",dense:""}},[t(b.A,{staticClass:"searchChatBar",attrs:{"prepend-inner-icon":"mdi-magnify",label:"Search for a chat",dense:"",outlined:"",color:"main-green",placeholder:"Search for a chat","hide-details":""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.performSearch.apply(null,arguments)},input:e.onInput},model:{value:e.searchChat,callback:function(t){e.searchChat=t},expression:"searchChat"}}),e.searchResults.length>0||e.noResults?t(h.A,{staticClass:"search-results-list"},[e.searchResults.length>0?e._l(e.searchResults,(function(s,a){return t(p.A,{key:a,on:{click:function(t){return e.scrollToMessage(s.index)}}},[t(m.pr,[t(m.UZ,[e._v(e._s(s.content))])],1)],1)})):[t(p.A,[t(m.pr,[t(m.UZ,[e._v("No records found")])],1)],1)]],2):e._e()],1),t("chat-windows",{ref:"chatWindows",staticClass:"chatWindows"})],1),t("wound-photos",{staticClass:"photo-section",class:{"photo-section--mobile":e.$vuetify.breakpoint.smAndDown,"photo-section--open":e.isPhotoSectionOpen&&e.$vuetify.breakpoint.smAndDown},attrs:{albums:e.albums,"current-album":e.currentAlbum,"selected-patient-id":e.currentAlbum,selectedChatroom:e.selectedChatroom},on:{"update:currentAlbum":function(t){e.currentAlbum=t},"update:current-album":[function(t){e.currentAlbum=t},e.updateCurrentAlbum]}})],1),t("div",{staticClass:"mobile-actions d-md-none",class:{"mobile-actions--hidden":e.isMessageLayoutOpen}},[t("div",{staticClass:"mobile-actions-container pt-1 pb-2 px-1"},[t(r.A,{staticClass:"mobile-action-btn rounded-lg",class:{active:e.isPhotoSectionOpen},attrs:{elevation:"0",text:""},on:{click:e.togglePhotoSection}},[t("div",{staticClass:"d-flex flex-column align-center"},[t(d.A,{staticClass:"action-icon"},[e._v(e._s(e.isPhotoSectionOpen?"mdi-arrow-left":"mdi-image"))]),t("span",{staticClass:"action-text"},[e._v(e._s(e.isPhotoSectionOpen?"Back":"Photos"))])],1)]),t(r.A,{staticClass:"mobile-action-btn py-1 rounded-lg",attrs:{elevation:"0",text:""},on:{click:e.openUploadImage}},[t("div",{staticClass:"d-flex flex-column align-center"},[t(d.A,{staticClass:"action-icon"},[e._v("mdi-paperclip")]),t("span",{staticClass:"action-text"},[e._v("Upload")])],1)]),t(r.A,{staticClass:"mobile-action-btn rounded-lg",attrs:{elevation:"0",text:""},on:{click:e.openMessageLayout}},[t("div",{staticClass:"d-flex flex-column align-center"},[t(d.A,{staticClass:"action-icon"},[e._v("mdi-message-text")]),t("span",{staticClass:"action-text"},[e._v("Message")])],1)]),e.userProfile.super_user?t(r.A,{staticClass:"mobile-action-btn rounded-lg",attrs:{elevation:"0",text:""},on:{click:e.goChatList}},[t("div",{staticClass:"d-flex flex-column align-center"},[t(d.A,{staticClass:"action-icon"},[e._v("mdi-account-multiple")]),t("span",{staticClass:"action-text"},[e._v("Patients")])],1)]):e._e()],1)])],1),t("msg-layout",{attrs:{visible:e.isMessageLayoutOpen},on:{"update:visible":function(t){e.isMessageLayoutOpen=t},"send-message":e.handleSendMessage,"message-uploaded":e.handleMessageUploaded}}),t("UploadImage",{key:`imgupload-${e.uploadImgKey}`,attrs:{activeUpload:e.uploadImage},on:{close:e.closeUploadImage,"update:visible":e.updateVisible,"message-uploaded":e.handleMessageUploaded}})],1)},C=[],A=(s(4114),s(6895)),I=s(5349),P=function(){var e=this,t=e._self._c;return t(n.A,{staticClass:"chat-container"},[t(I.A,{attrs:{width:"200"},model:{value:e.detectError,callback:function(t){e.detectError=t},expression:"detectError"}},[t(A.A,{attrs:{dense:"",type:"error"}},[e._v(" Error ")])],1),t("div",{staticClass:"px-0 mr-n3"},[t("ProgressLoader",{key:e.activeKey,attrs:{showText:"LOADING...",active:e.activeProgress}}),t("div",{ref:"chatWindow",staticClass:"chat-window pt-1 pb-4"},[t("infinite-loading",{attrs:{direction:"top",identifier:e.infiniteId},on:{infinite:e.infiniteHandler}},[t("div",{attrs:{slot:"no-more"},slot:"no-more"},[e._v("No more comments")]),t("div",{attrs:{slot:"no-results"},slot:"no-results"},[e._v("No more comments")])]),e._l(e.messages,(function(s,a){return t("chat-message",{key:a,attrs:{is_carer_user:s.is_carer_user,content_type:s.content_type,user_name:s.user_name,content:s.content,media_url:s.media_url,isFirstDate:s.isFirstDate},on:{"image-click":function(t){return e.openImagePopup(`${e.IMG_PATH}media/${s.media_url}`)},"image-click2":function(t){return e.openImagePopup(s.media_url)}}})}))],2)],1),t("div",[t("div",{staticClass:"send-message-layout d-none d-md-flex"},[t(b.A,{staticClass:"message-input mb-13 mx-3",attrs:{placeholder:"Type your message here",outlined:"",hint:"Shift + Enter for a new line, Enter to send: ","persistent-hint":""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)}},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}}),t("div",{staticClass:"action-buttons"},[t("button",{staticClass:"send-btn px-1 mr-1",attrs:{elevation:"0",color:"white"},on:{click:e.sendMessage}},[t(d.A,{attrs:{color:"main-green"}},[e._v("mdi-send")])],1),t(r.A,{staticClass:"upload-btn main-green",class:{"upload-btn--mobile":e.$vuetify.breakpoint.xs},attrs:{elevation:"0",color:"primary"},on:{click:e.openUploadImage}},[t(d.A,[e._v("mdi-paperclip")]),t("span",{staticClass:"d-none d-sm-inline"},[e._v("Upload")])],1)],1)],1)]),t("ImagePopup",{key:`imgpop-${e.popImgKey}`,attrs:{image:e.selectedImage,visible:e.imagePopupVisible},on:{close:e.closeImagePopup}}),t("UploadImage",{key:`imgupload-${e.uploadImgKey}`,attrs:{activeUpload:e.uploadImage},on:{close:e.closeUploadImage,"update:visible":e.updateVisible,"message-uploaded":e.handleMessageUploaded}})],1)},x=[],k=s(4335),M=s(5147),S=s(8560),$=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"date-divider text-center grey--text font-small"},[e._v(e._s(e.isFirstDate))]),t(f.A,{class:e.alignmentClass,staticStyle:{margin:"0"}},["text"===e.content_type?t(l.A,{attrs:{cols:"auto"}},[t(M.A,{staticClass:"mr-4",class:[e.messageClass,"mr-4"],attrs:{flat:""}},[t(S.OQ,{staticClass:"font-large font-weight-bold font-weight-bold",domProps:{innerHTML:e._s(e.contentRegexMatchURL)}})],1)],1):"image"===e.content_type?t(l.A,{key:e.media_url,staticClass:"img_col img_col",attrs:{cols:"5"}},[t(M.A,{staticClass:"mr-4",class:[e.messageClass,"mr-4"],attrs:{color:"point-1",flat:""}},[t("img",{attrs:{src:`${e.IMG_PATH}media/${e.media_url}`},on:{click:function(t){return e.$emit("image-click",`${e.IMG_PATH}media/${e.media_url}`)}}})])],1):"image2"===e.content_type?t(l.A,{key:e.media_url,staticClass:"img_col",attrs:{cols:"5"}},[t(M.A,{staticClass:"mr-4",class:[e.messageClass,"mr-4"],attrs:{color:"point-1",flat:""}},[t("img",{attrs:{src:e.media_url},on:{click:function(t){return e.$emit("image-click2",e.media_url)}}})])],1):e._e()],1)],1)},U=[],R={name:"ChatMessage",props:{is_carer_user:{type:Boolean,required:!0},content_type:{type:String,required:!0},user_name:{type:String,required:!0},content:{type:String,required:!0},media_url:{type:String,required:!0},isFirstDate:{type:String,required:!0}},computed:{contentRegexMatchURL:function(){let e=this.content;const t=/https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)/g,s=e.match(t);return s&&(e=e.replace(t,`<a style="margin: 0 5px;" href="${s[0]}" target="_blank">${s[0]}</a>`)),e},alignmentClass(){const e=this.$root.userProfile?.super_user;return e?this.is_carer_user?"justify-end":"justify-start":this.is_carer_user?"justify-start":"justify-end"},messageClass(){const e=this.$root.userProfile?.super_user;return e?this.is_carer_user?"own-message":"other-message":this.is_carer_user?"other-message":"own-message"}},watch:{}},T=R,O=s(845),E=(0,O.A)(T,$,U,!1,null,"1172d7bb",null),D=E.exports,L=s(8719),H=s(422),N=s(4923),V=function(){var e=this,t=e._self._c;return t(I.A,{attrs:{"max-width":"500px",scrollable:""},model:{value:e.uploadImage,callback:function(t){e.uploadImage=t},expression:"uploadImage"}},[t(M.A,[t(S.ri,{staticClass:"font-large font-weight-bold text-center"},[e._v(" Upload a photo of the wound "),t("span",{staticClass:"font-weight-regular font-small grey--text ml-1"},[e._v("JPG and PNG image files only(Max: 8MB)")])]),t(S.OQ,[t(n.A,{staticClass:"uploader-area",class:{"is-dragging":e.fileOnDrag}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.filePreviewSrc,expression:"filePreviewSrc"}],staticClass:"uploader-preview"},[t(r.A,{staticClass:"uploader-remove-btn",on:{click:e.handleResetInput}},[t(d.A,{attrs:{color:"primary"}},[e._v("mdi-trash-can-outline")])],1),t(u.A,{attrs:{src:e.filePreviewSrc,contain:""}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.filePreviewSrc,expression:"!filePreviewSrc"}]},[t("input",{ref:"fileInput",staticClass:"uploader-input",attrs:{type:"file",accept:"image/jpeg, image/png"},on:{dragenter:e.handleDragEnter,dragleave:e.handleDragEnter,dragdrop:e.handleDragDrop,change:e.handleInputChange}}),t("div",{staticClass:"uploader-interface"},[t(d.A,{attrs:{size:"40",color:"#dcdcdc"}},[e._v("mdi-cloud-upload-outline")]),t("p",{class:{"error-message":e.showErrorMsg}},[e._v(e._s(e.displayFileTips))])],1)])])],1),t(S.SL,{staticClass:"justify-end"},[t(r.A,{attrs:{text:"",color:"v-dark"},on:{click:e.handleClose}},[e._v("Cancel")]),t(r.A,{attrs:{color:"primary",text:"",disabled:!e.canUpload},on:{click:e.startUpload}},[e.showLoading?t(N.A,{attrs:{indeterminate:"",color:"white",size:"20"}}):t("span",[e._v("Submit upload")])],1)],1)],1)],1)},z=[],F=(s(4603),s(7566),s(8721),{props:{activeUpload:Boolean},data(){return{uploadImage:this.activeUpload,file:null,filePreviewSrc:"",fileOnDrag:!1,fileTips:"Drag and drop or click to upload images",showErrorMsg:!1,canUpload:!1,showLoading:!1}},computed:{displayFileTips(){return this.$vuetify.breakpoint.smAndDown?"Click to upload images":this.fileTips}},methods:{startUpload(){const e=this.userProfile.id;let t;const s=JSON.parse(localStorage.getItem("mackay"));t=this.userProfile.super_user?s.room_path?s.room_path:this.storeChatRoom:this.userProfile.room_path;const a=!0===this.userProfile.super_user?"1":"0",i=new FormData,o=(new Date).getTime();console.log("this.file",this.file),i.append("user_id",e),i.append("chatRoom",t),i.append("is_carer_user",a),i.append("photo_upload",this.file,`${e}_${o}.${this.file.type.split("/")[1]}`),k.A.post(`${this.SERVER_PATH}api/chat/upload`,i,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{console.log("Message sent successfully:",e.data),this.uploadImage=!1;const t=this.userProfile.name||"您",s={is_carer_user:"1"===a,user_name:t,media_url:this.filePreviewSrc,content_type:"image2",content:"",isFirstDate:""};this.$emit("message-uploaded",s),this.$root.$emit("upload-success"),this.$nextTick((()=>{const e=this.$parent.$refs.chatWindow;e&&(e.scrollTop=e.scrollHeight)}))})).catch((e=>{console.error("Error sending message:",e)}))},triggerFileInput(){this.$refs.fileInput.click()},handleResetInput(){console.log("handleResetInput",this.$refs.fileInput),this.canUpload=!1,this.$refs.fileInput.value="",this.filePreviewSrc="",this.fileTips=this.$options.data().fileTips},handleInputChange(e){const t=e.target.files[0];t&&this.handleUploadFile(t)},handleUploadFile(e){if(this.fileOnDrag=!1,this.showErrorMsg=!1,"image/jpeg"===e.type||"image/png"===e.type){const t=window.URL||window.webkitURL,s=new Image;s.src=t.createObjectURL(e),s.onload=()=>{e.size<8192e3?(this.fileTips=e.name,this.canUpload=!0,this.filePreviewSrc=s.src,this.file=e):(this.showErrorMsg=!0,this.fileTips="File size must be under 8MB",this.file=null)}}else this.showErrorMsg=!0,this.fileTips="File format is not supported"},handleDragEnter(e){e.preventDefault(),this.fileOnDrag=!0},handleDragLeave(){this.fileOnDrag=!1},handleDragDrop(e){e.preventDefault(),this.fileOnDrag=!1;const t=e.dataTransfer.files;if(t&&t.length>0){const e=t[0];this.handleUploadFile(e)}},handleChange(e){this.handleUploadFile(e)},handleClose(){this.uploadImage=!1}}}),K=F,G=(0,O.A)(K,V,z,!1,null,"949aad98",null),W=G.exports,B={name:"ChatWindows",components:{ImagePopup:H.A,ChatMessage:D,ProgressLoader:L.A,UploadImage:W},data(){return{newMessage:"",selectedImage:"",messages:[],user_name:"",user_id:null,preloader:!0,imagePopupVisible:!1,activeProgress:!1,detectError:!1,uploadImage:!1,page:1,size:16,popImgKey:1,uploadImgKey:1,activeKey:1,infiniteId:1}},created(){this.activeProgress=!0,this.$route.params.id?this.fetchMessages():this.routerRedirectTo404()},mounted(){document.body.classList.add("disable-scroller"),document.documentElement.style.overflow="hidden"},destroyed(){document.body.classList.remove("disable-scroller"),document.documentElement.style.overflow="unset"},methods:{fetchMessages(){let e,t,s;const a=JSON.parse(localStorage.getItem("mackay"));this.userProfile.super_user?(t=this.storeUserId,s=a.room_path?a.room_path:this.storeChatRoom):(t=this.userProfile.id,s=this.userProfile.room_path),e=t||a.selectedId,console.log("fetchMessages",this.userProfile.id,this.storeUserId);const i=this.$route.params.id.split("-")[0];if(this.userProfile.super_user){const e=JSON.parse(localStorage.getItem("mackay")),t=e.selectedId;if(t!=i)return void this.$router.push("/chat")}else if(e!=i)return void this.routerRedirectTo404();console.log("fetchMessages 1",e),k.A.get(`${this.SERVER_PATH}api/chat/list?`,{params:{user_id:this.userProfile.id,chatRoom:s,page:this.page,size:this.size}}).then((e=>{e.data.count?this.user_name=e.data.results[0].user_name:this.user_name="",console.log(JSON.stringify(e.data)),this.preloader=!1,this.messages=e.data.results,console.table("fetchMessages 3",this.messages),this.page+=1,this.infiniteId+=1,e.data.count?this.user_name=e.data.results[0].user_name:this.user_name="",setTimeout((()=>{this.$nextTick((()=>{this.activeProgress=!1,this.activeKey+=1;const e=this.$refs.chatWindow;e&&(e.scrollTop=e.scrollHeight)}))}),1e3)})).catch((e=>{this.detectError=!0,console.error(e.response.status),404===e.response.status||403===e.response.status?this.routerRedirectTo404():this.userProfile.super_user?this.$router.push({name:"chat-list"}):this.routerRedirectTo404()}))},infiniteHandler(e){let t;const s=JSON.parse(localStorage.getItem("mackay"));t=this.userProfile.super_user?s.room_path?s.room_path:this.storeChatRoom:this.userProfile.room_path,this.preloader||k.A.get(`${this.SERVER_PATH}api/chat/list?`,{params:{user_id:this.userProfile.id,chatRoom:t,page:this.page,size:this.size}}).then((t=>{!t.data.results.length||t.data.count<=this.size?e.complete():(console.log("infiniteHandler",this.page),this.messages.push(...t.data.results),this.page+=1,e.loaded())}))},sendMessage(){let e;const t=JSON.parse(localStorage.getItem("mackay"));if(e=this.userProfile.super_user?t.room_path?t.room_path:this.storeChatRoom:this.userProfile.room_path,""!==this.newMessage.trim()){const t=this.userProfile.name||"您",s=!0===this.userProfile.super_user,a={is_carer_user:s,user_name:t,media_url:"",content:this.newMessage,content_type:"text",isFirstDate:""};this.messages.push(a),this.newMessage="",this.$nextTick((()=>{const e=this.$refs.chatWindow;e&&(e.scrollTop=e.scrollHeight)})),k.A.post(`${this.SERVER_PATH}api/chat/control`,{user_id:this.userProfile.id,chatRoom:e,is_carer_user:s,content:a.content,content_type:"text"}).then((e=>{console.log("Message sent successfully:",e.data)})).catch((e=>{console.error("Error sending message:",e)}))}},openImagePopup(e){this.selectedImage=e,this.imagePopupVisible=!0,this.popImgKey+=1,console.log("openImagePopup",this.imagePopupVisible)},closeImagePopup(e){this.imagePopupVisible=e,this.selectedImage="",this.popImgKey+=1},updateVisible(e){this.imagePopupVisible=e},openUploadImage(){this.uploadImage=!0,this.uploadImgKey+=1},closeUploadImage(){this.uploadImage=!1},handleMessageUploaded(e){console.log("Message uploaded:",e),this.messages.push(e)}}},J=B,j=(0,O.A)(J,P,x,!1,null,"07933ba3",null),Z=j.exports,q=s(7672),Q=I.A.extend({name:"v-bottom-sheet",props:{inset:Boolean,maxWidth:[String,Number],transition:{type:String,default:"bottom-sheet-transition"}},computed:{classes(){return{...I.A.options.computed.classes.call(this),"v-bottom-sheet":!0,"v-bottom-sheet--inset":this.inset}}}}),Y=s(2804),X=s(8961);const ee=(0,X.A)(b.A);var te=ee.extend({name:"v-textarea",props:{autoGrow:Boolean,noResize:Boolean,rowHeight:{type:[Number,String],default:24,validator:e=>!isNaN(parseFloat(e))},rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseInt(e,10))}},computed:{classes(){return{"v-textarea":!0,"v-textarea--auto-grow":this.autoGrow,"v-textarea--no-resize":this.noResizeHandle,...b.A.options.computed.classes.call(this)}},noResizeHandle(){return this.noResize||this.autoGrow}},watch:{autoGrow(e){this.$nextTick((()=>{var t;e?this.calculateInputHeight():null===(t=this.$refs.input)||void 0===t||t.style.removeProperty("height")}))},lazyValue(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)},rowHeight(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)}},mounted(){setTimeout((()=>{this.autoGrow&&this.calculateInputHeight()}),0)},methods:{calculateInputHeight(){const e=this.$refs.input;if(!e)return;e.style.height="0";const t=e.scrollHeight,s=parseInt(this.rows,10)*parseFloat(this.rowHeight);e.style.height=Math.max(s,t)+"px"},genInput(){const e=b.A.options.methods.genInput.call(this);return e.tag="textarea",delete e.data.attrs.type,e.data.attrs.rows=this.rows,e},onInput(e){b.A.options.methods.onInput.call(this,e),this.autoGrow&&this.calculateInputHeight()},onKeyDown(e){this.isFocused&&13===e.keyCode&&e.stopPropagation(),this.$emit("keydown",e)}}}),se=s(170);const ae=(0,se.Gn)("v-toolbar__title"),ie=(0,se.Gn)("v-toolbar__items");y.A;var oe=function(){var e=this,t=e._self._c;return t(Q,{attrs:{inset:""},model:{value:e.localVisible,callback:function(t){e.localVisible=t},expression:"localVisible"}},[t(Y.A,{staticClass:"message-layout"},[t(y.A,{attrs:{dense:"",color:"main-green",dark:""}},[t(_.A),t(ae,{staticClass:"text-center mx-auto"},[e._v("New Message")]),t(_.A),t(r.A,{staticClass:"ml-n6",attrs:{icon:"",dark:""},on:{click:e.close}},[t(d.A,[e._v("mdi-close")])],1)],1),t(S.OQ,{staticClass:"message-input-area"},[t(te,{staticClass:"message-textarea",attrs:{outlined:"",color:"main-green","auto-grow":"",rows:"4","row-height":"30",placeholder:"Type your message here","hide-details":""},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}}),t("div",{staticClass:"action-buttons-grid"},[t("div",{staticClass:"grid-item"},[t(r.A,{staticClass:"action-btn",attrs:{color:"main-green",text:""},on:{click:e.openUploadImage}},[t("div",{staticClass:"d-flex"},[t(d.A,{staticClass:"mb-1"},[e._v("mdi-paperclip")]),t("span",{staticClass:"caption"},[e._v("Upload")])],1)])],1),t("div",{staticClass:"grid-item text-right"},[t(r.A,{staticClass:"action-btn",attrs:{color:"main-green",text:"",disabled:!e.newMessage.trim()},on:{click:e.sendMessage}},[t("div",{staticClass:"d-flex"},[t(d.A,{staticClass:"mb-1"},[e._v("mdi-send")]),t("span",{staticClass:"caption"},[e._v("Send")])],1)])],1)])],1)],1),t("UploadImage",{key:`imgupload-${e.uploadImgKey}`,attrs:{activeUpload:e.uploadImage},on:{close:e.closeUploadImage,"update:visible":e.updateVisible,"message-uploaded":e.handleMessageUploaded}})],1)},re=[],le={name:"MsgLayout",components:{UploadImage:W},props:{visible:{type:Boolean,default:!1}},data(){return{newMessage:"",uploadImage:!1,uploadImgKey:1,localVisible:!1}},watch:{visible(e){this.localVisible=e,e||(this.newMessage="")},localVisible(e){this.$emit("update:visible",e)}},methods:{close(){this.localVisible=!1,this.newMessage=""},sendMessage(){this.newMessage.trim()&&(this.$emit("send-message",this.newMessage),this.newMessage="",this.close())},openUploadImage(){this.uploadImage=!0,this.uploadImgKey+=1},closeUploadImage(){this.uploadImage=!1},updateVisible(e){this.uploadImage=e},handleMessageUploaded(e){this.$emit("message-uploaded",e),this.close()}}},ne=le,ce=(0,O.A)(ne,oe,re,!1,null,"b6dc84f6",null),de=ce.exports,ue=s(5353),he={components:{ChatWindows:Z,WoundPhotos:q.A,MsgLayout:de,UploadImage:W},data(){return{username:"使用者",thumb_avatar:"",searchChat:"",searchResults:[],noResults:!1,topBarNavList:["One","Two","Three"],chatRecord:[],albums:[],currentAlbum:0,selectedChatroom:"",isPhotoSectionOpen:!1,isMessageLayoutOpen:!1,uploadImage:!1,uploadImgKey:1}},computed:{currentPhotos(){return this.albums[this.currentAlbum]?.photos||[]}},methods:{updateCurrentAlbum(e){this.currentAlbum=e},onInput(){this.performSearch()},performSearch(){const e=this.searchChat.trim().toLowerCase();if(e){const t=this.$refs.chatWindows.messages.map(((e,t)=>({content:e.content,index:t}))).filter((t=>t.content.toLowerCase().includes(e)));t.length>0?(this.searchResults=t,this.noResults=!1):(this.searchResults=[],this.noResults=!0)}else this.searchResults=[],this.noResults=!1},scrollToMessage(e){const t=this.$refs.chatWindows.$refs.chatWindow,s=t.children;if(s[e]){const a=s[e].offsetTop;t.scrollTo({top:a,behavior:"smooth"})}this.searchResults=[]},goChatList(){this.UPDATE_USER_ID(this.userProfile.id);const e=JSON.parse(localStorage.getItem("mackay")||"{}");e.user_id=this.userProfile.id,localStorage.setItem("mackay",JSON.stringify(e)),this.$router.push({path:"/chat/"})},togglePhotoSection(){this.isPhotoSectionOpen=!this.isPhotoSectionOpen,this.isPhotoSectionOpen?(document.body.classList.add("disable-scroller"),document.documentElement.style.overflow="hidden"):(document.body.classList.remove("disable-scroller"),document.documentElement.style.overflow="unset")},destroyed(){document.body.classList.remove("cc-overflow-hide"),document.documentElement.style.overflow="unset"},openMessageLayout(){this.isPhotoSectionOpen&&(this.isPhotoSectionOpen=!1),this.isMessageLayoutOpen=!0},openUploadImage(){document.body.classList.add("disable-scroller"),this.uploadImage=!0,this.uploadImgKey+=1},closeUploadImage(){document.body.classList.remove("disable-scroller"),this.uploadImage=!1},updateVisible(e){this.uploadImage=e},handleSendMessage(e){this.$refs.chatWindows.newMessage=e,this.$refs.chatWindows.sendMessage()},handleMessageUploaded(e){this.$refs.chatWindows.handleMessageUploaded(e)},handleDropdownClick(){this.isPhotoSectionOpen&&(this.isPhotoSectionOpen=!1)},...(0,ue.PY)(["UPDATE_USER_ID"])},mounted(){this.userProfile.name&&(this.username=this.userProfile.name),this.userProfile.thumb&&(this.thumb_avatar=this.userProfile.thumb)}},pe=he,me=(0,O.A)(pe,w,C,!1,null,"2a80a966",null),ge=me.exports}}]);
//# sourceMappingURL=518.f03fa936.js.map