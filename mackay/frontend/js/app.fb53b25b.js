(function(){"use strict";var e={5392:function(e,t,r){r(4114);var o=r(5471),n=r(2781),a=r(8505),s=r(7954),i=function(){var e=this,t=e._self._c;return t(a.A,[e.alert.show?t(n.A,{staticClass:"login-alert",attrs:{dense:"",transition:"scale-transition",value:e.alert_timeout,type:e.alert.status}},[e._v(" "+e._s(e.alert.message)+" ")]):e._e(),t(s.A,[t("router-view")],1)],1)},u=[],l=r(127),c={name:"App",data:()=>({alertShow:!1,alertStatus:"",alert_timeout:!0,timer:""}),created(){},mounted(){console.log("this.$route",this.$route),console.log("this.$route.name",this.$route.name),this.initializeApp().then((()=>{this.autoRelogin()}))},methods:{detectAutoLoginProcess(){const e=localStorage.getItem("mackay"),t=JSON.parse(localStorage.getItem("mackay"));if(console.log("getJWTData_id",t.user_id),e){const r=l(e),{exp:o}=r,n=Date.now()/1e3;if(console.log("JWT content: ",r),o-n>0){const e={name:r.name,line_id:r.sub,thumb:r.picture};this.updateUserProfile(e),this.updateUserId(t.user_id),this.updateUserLogin(!0),this.updateAlert({show:!0,status:"success",message:"Login ok!"})}this.$router.push("/chat/"+t.user_id)}else this.updateUserProfile({}),this.updateUserLogin(!1),this.updateAlert({show:!0,status:"error",message:"Please log in again!"}),this.$router.push({name:"woundLogin"})},async initializeApp(){const e=await this.loadLocalStorageData();console.log("LocalStorage 已加載:",e)},loadLocalStorageData(){return new Promise((e=>{const t=localStorage.getItem("mackay");e(t)}))}},watch:{"alert.show"(e){e&&(this.alert_timeout=!0,setTimeout((()=>{this.alert_timeout=!1,this.updateAlert({show:!1,status:"",message:""})}),3e3))}}},d=c,h=r(845),p=(0,h.A)(d,i,u,!1,null,null,null),f=p.exports,m=r(173);const g=()=>Promise.all([r.e(559),r.e(512),r.e(175)]).then(r.bind(r,9175)),_=()=>Promise.all([r.e(559),r.e(512),r.e(788)]).then(r.bind(r,5788)),v=()=>Promise.all([r.e(559),r.e(671)]).then(r.bind(r,5671)),b=()=>r.e(177).then(r.bind(r,9177));o.Ay.use(m.Ay);const A=[{path:"/",name:"woundLogin",component:v},{path:"/chat",name:"chat-list",component:g},{path:"/chat/:id",name:"chat-room",component:_},{path:"/404",name:"error404",component:b},{path:"*",redirect:{name:"error404"}}],y=new m.Ay({mode:"history",routes:A});var U=y,w=r(5353);o.Ay.use(w.Ay);var L=new w.Ay.Store({state:{user_profile:{},user_login:!1,alert:{show:!1,status:""},user_Id:null},getters:{exportUserProfile(e){return e.user_profile},exportUserId(e){return e.user_Id},exportUserLogin(e){return e.user_login},exportAlert(e){return e.alert}},mutations:{UPDATE_USER_PROFILE(e,t){e.user_profile=t},UPDATE_USER_ID(e,t){e.user_Id=t},UPDATE_USER_LOGIN(e,t){e.user_login=t},UPDATE_ALERT(e,t){e.alert=t},SET_USER_ID(e,t){e.user_Id=t}},actions:{updateUserId({commit:e},t){e("SET_USER_ID",t)}},modules:{}}),S=r(5453),P=r(6963);o.Ay.use(S.A);var E=new S.A({theme:{themes:{light:{primary:"#66bb6a",secondary:"#424242",accent:"#8c9eff",error:"#d8374d",success:"#4CAF50",warning:"#da8200","main-green":"#2D9CA0","v-light":"#eee","v-dark":"#242526","v-dark2":"#161616","color-1":"#d6545c","color-2":"#f98068","color-3":"#f0c158","color-4":"#98cb69","color-5":"#00b69e","pain-1":"#00b69e","pain-2":"#98cb69","pain-3":"#f0c158","pain-4":"#f98068","pain-5":"#d6545c","point-0":"#49954c","point-1":"#fff","point-2":"#f0c158","point-3":"#d6545c","level-4":"#f0c158","level-5":"#d6545c","level-reverse-2":"#f0c158","level-reverse-1":"#d6545c","record-basic":"#5580a0","record-se":"#616eb7","record-se1":"#616eb7","record-se2":"#616eb7","record-event":"#915c4c","record-trail":"#49954c","record-profile":"#ef6357","real-reply":"#ffdd73"}}},lang:{locales:{zhHant:P.A},current:"zhHant"}}),I=(r(6044),r(2252)),T=r.n(I),k=r(4335);o.Ay.prototype.$http=k.A,o.Ay.config.productionTip=!1,o.Ay.component("infinite-loading",T());const O={data:()=>({SERVER_PATH:"/",VUE_PATH:"//127.0.0.1:8000/"}),methods:{...(0,w.PY)({updateUserProfile:"UPDATE_USER_PROFILE",updateUserLogin:"UPDATE_USER_LOGIN",updateUserId:"UPDATE_USER_ID",updateAlert:"UPDATE_ALERT"}),autoRelogin(){const e=localStorage.getItem("isLoginWithJwt");if(e){const e=localStorage.getItem("mackay"),t=JSON.parse(e);if(console.log("Check JWT",t),e){const e=l(t.jwt),r={name:e.name,line_id:e.sub,thumb:e.picture,id:t.user_id,super_user:t.super_user,room_path:t.room_path};console.log("autoRelogin",r),this.updateUserLogin(!0),this.updateUserProfile(r),this.updateUserId(r.id),r&&this.updateUserId(r.id),this.updateAlert({show:!0,status:"success",message:"Login ok!"})}else this.updateUserProfile(null),this.updateUserId(null),this.updateUserLogin(!1),this.updateAlert({show:!0,status:"error",message:"Please login again!"}),this.$router.push("/"),alert("route to login2")}else setTimeout((()=>{const e=localStorage.getItem("isLoginWithJwt");e||(this.updateUserProfile(null),this.updateUserId(null),this.updateUserLogin(!1),this.updateAlert({show:!0,status:"error",message:"Please login again!"}),"/"!=this.$route.path&&this.$router.push("/"))}),1e3)},routerRedirectTo404(){this.$router.push({name:"error404"})},userLoginProcess(e,t){return k.A.post("http://127.0.0.1:8000/api/member/line_login",{code:e,state:t}).then((e=>{const t=e.data.jwt_token;if(t){console.log("JWT content: ",t);const r={jwt:t,user_id:e.data.user_id,super_user:e.data.super_user,room_path:e.data.room_path};localStorage.setItem("mackay",JSON.stringify(r)),localStorage.setItem("isLoginWithJwt",!0);const o=l(t),n={name:o.name,line_id:o.sub,thumb:o.picture,id:e.data.user_id,super_user:e.data.super_user,room_path:e.data.room_path};this.updateUserProfile(n),this.updateUserId(n.id),this.updateUserLogin(!0),this.updateAlert({show:!0,status:"success",message:"Login ok!"}),console.log("LOGIN STATUS: ",this.userLogin),console.log("USER_PROFILE: ",n)}1==e.data.super_user?this.$router.push("/chat"):this.$router.push("/chat/"+e.data.room_path)})).catch((e=>{console.error("LINE LOGIN Failed:",e),this.updateUserProfile({}),this.updateUserId(""),this.updateUserLogin(!1),this.updateAlert({show:!0,status:"error",message:"Please log in again!"}),localStorage.removeItem("mackay")})),!0},logout(){localStorage.removeItem("mackay"),localStorage.removeItem("isLoginWithJwt"),this.updateAlert({show:!0,status:"success",message:"Logged out ok!"}),setTimeout((()=>{this.$router.push("/")}),1e3)}},computed:{...(0,w.L8)({userProfile:"exportUserProfile",userLogin:"exportUserLogin",storeUserId:"exportUserId",alert:"exportAlert"})}};o.Ay.mixin(O),new o.Ay({router:U,store:L,vuetify:E,render:e=>e(f)}).$mount("#app")}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,r),a.exports}r.m=e,function(){var e=[];r.O=function(t,o,n,a){if(!o){var s=1/0;for(c=0;c<e.length;c++){o=e[c][0],n=e[c][1],a=e[c][2];for(var i=!0,u=0;u<o.length;u++)(!1&a||s>=a)&&Object.keys(r.O).every((function(e){return r.O[e](o[u])}))?o.splice(u--,1):(i=!1,a<s&&(s=a));if(i){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[o,n,a]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,o){return r.f[o](e,t),t}),[]))}}(),function(){r.u=function(e){return"js/"+e+"."+{175:"823597d6",177:"f1f22b19",512:"dd0e08ad",559:"2b2c72d2",671:"80512bed",788:"658352cc"}[e]+".js"}}(),function(){r.miniCssF=function(e){return"css/"+e+"."+{175:"e1d67b51",177:"1eb70854",512:"f21f4a88",559:"c38afd2f",671:"bb2375b0",788:"db985c00"}[e]+".css"}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="wound-chat:";r.l=function(o,n,a,s){if(e[o])e[o].push(n);else{var i,u;if(void 0!==a)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+a){i=d;break}}i||(u=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+a),i.src=o),e[o]=[n];var h=function(t,r){i.onerror=i.onload=null,clearTimeout(p);var n=e[o];if(delete e[o],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach((function(e){return e(r)})),t)return t(r)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),u&&document.head.appendChild(i)}}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){r.p="/static/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,o,n,a){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",r.nc&&(s.nonce=r.nc);var i=function(r){if(s.onerror=s.onload=null,"load"===r.type)n();else{var o=r&&r.type,i=r&&r.target&&r.target.href||t,u=new Error("Loading CSS chunk "+e+" failed.\n("+o+": "+i+")");u.name="ChunkLoadError",u.code="CSS_CHUNK_LOAD_FAILED",u.type=o,u.request=i,s.parentNode&&s.parentNode.removeChild(s),a(u)}};return s.onerror=s.onload=i,s.href=t,o?o.parentNode.insertBefore(s,o.nextSibling):document.head.appendChild(s),s},t=function(e,t){for(var r=document.getElementsByTagName("link"),o=0;o<r.length;o++){var n=r[o],a=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(a===e||a===t))return n}var s=document.getElementsByTagName("style");for(o=0;o<s.length;o++){n=s[o],a=n.getAttribute("data-href");if(a===e||a===t)return n}},o=function(o){return new Promise((function(n,a){var s=r.miniCssF(o),i=r.p+s;if(t(s,i))return n();e(o,i,null,n,a)}))},n={524:0};r.f.miniCss=function(e,t){var r={175:1,177:1,512:1,559:1,671:1,788:1};n[e]?t.push(n[e]):0!==n[e]&&r[e]&&t.push(n[e]=o(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}}(),function(){var e={524:0};r.f.j=function(t,o){var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var a=new Promise((function(r,o){n=e[t]=[r,o]}));o.push(n[2]=a);var s=r.p+r.u(t),i=new Error,u=function(o){if(r.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var a=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;i.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",i.name="ChunkLoadError",i.type=a,i.request=s,n[1](i)}};r.l(s,u,"chunk-"+t,t)}},r.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,a,s=o[0],i=o[1],u=o[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(n in i)r.o(i,n)&&(r.m[n]=i[n]);if(u)var c=u(r)}for(t&&t(o);l<s.length;l++)a=s[l],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(c)},o=self["webpackChunkwound_chat"]=self["webpackChunkwound_chat"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=r.O(void 0,[504],(function(){return r(5392)}));o=r.O(o)})();
//# sourceMappingURL=app.fb53b25b.js.map