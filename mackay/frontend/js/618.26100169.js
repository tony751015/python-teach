"use strict";(self["webpackChunkwound_chat"]=self["webpackChunkwound_chat"]||[]).push([[618],{618:function(t,e,s){s.r(e),s.d(e,{default:function(){return O}});var a=s(6929),i=s(8400),n=s(6074),r=s(375),o=s(1526),l=s(4739),u=s(9456),c=s(3825),p=s(2987),h=s(1075),d=s(6315),g=s(7313),m=s(9581),_=s(6520),f=s(1228),P=s(8412),A=s(7410),v=s(3661),b=s(3507),C=s(6960),y=(0,b.A)(v.A).extend({name:"v-subheader",props:{inset:Boolean},render(t){return t("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},(0,C.$c)(this))}}),I=s(6648),S=s(5937),k=function(){var t=this,e=t._self._c;return e("div",[e(a.A,{attrs:{color:"main-green",elevation:"0",dense:""}},[e(f.A,{staticClass:"d-sm-none"},[e(i.A)],1),e("img",{staticClass:"main-logo",attrs:{src:s(5332),alt:"logo"}}),e(A.A,[[e(I.A,{attrs:{"align-with-title":"","background-color":"transparent"}})]],2),e(_.A,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(r.A,t._g(t._b({staticClass:"dropdown-btn",attrs:{rounded:"",color:"normal"}},"v-btn",a,!1),s),[e(n.A,{attrs:{size:"30"}},[e(c.A,{attrs:{src:t.thumb_avatar}})],1),e("span",{staticClass:"ml-2"},[t._v(t._s(t.username))]),e(u.A,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}])},[e(p.A,{attrs:{dense:""}},[e(h.A,[e(m.UZ,{staticClass:"logoutBtn",on:{click:t.logout}},[t._v("log out")])],1)],1)],1)],1),e(l.A,{staticClass:"fill-height",attrs:{fluid:""}},[e(P.A,[e(o.A,{staticClass:"chat-list-section",attrs:{cols:"8"}},[e(S.A,{attrs:{"prepend-icon":"mdi-magnify",label:"Search for a patient",dense:"",outlined:"",color:"main-green",placeholder:"Search for a patient","hide-details":""},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),e(p.A,[e(y,[t._v("Patient census: "+t._s(t.patientCount))]),t.preloading?t._e():[t._l(t.filteredPatients,(function(a){return e(h.A,{key:a.id,staticClass:"patient-item",class:{outlined:t.highlightedPatientId===a.user_id},on:{click:function(e){return t.selectPatient(a.user_id)}}},[e(g.A,{attrs:{size:"56"}},[e(c.A,{attrs:{src:a.user_avatar||s(4441)}})],1),e(m.pr,[e(m.UZ,[t._v(" "+t._s(a.user_name)+" "),e("span",{staticClass:"grey--text text--lighten-1 font-small"},[t._v(t._s("("+a.user_id+")"))])]),e(m.w,[a.last_message&&"text"===a.last_message.content_type?e("span",[t._v(" "+t._s(a.last_message.content)+" ")]):a.last_message&&"image"===a.last_message.content_type?e("span",[t._v(" 傳送了一張圖片 "),e(r.A,{staticClass:"px-1",attrs:{outlined:"",color:"main-green",small:""},on:{click:function(e){return e.stopPropagation(),t.openImagePopup(`${t.SERVER_PATH}media/${a.last_message.media_url}`)}}},[e(u.A,{staticClass:"font-normal"},[t._v("mdi-magnify")]),t._v(" photo ")],1)],1):e("span",[t._v("no message")])])],1),e(d.A,[e(r.A,{staticClass:"px-1",attrs:{outlined:"",elevation:"0",color:"main-green",small:""},on:{click:function(e){return e.stopPropagation(),t.goChatroom(a)}}},[t._v("Open Chat ")])],1),e(d.A,[e(r.A,{attrs:{fab:"",elevation:"0",color:a.pin?"main-green":""},on:{click:function(e){return e.stopPropagation(),t.togglePin(a)}}},[e(u.A,{attrs:{color:a.pin?"white":""}},[t._v("mdi-pin")])],1)],1)],1)})),e("infinite-loading",{attrs:{identifier:t.infiniteId,spinner:"bubbles",direction:"bottom"},on:{infinite:t.loadMorePatients}},[e("div",{staticClass:"infini-note grey--text text--lighten-1 font-small",attrs:{slot:"no-more"},slot:"no-more"},[t._v("No more data")]),e("div",{staticClass:"infini-note grey--text text--lighten-1 font-small",attrs:{slot:"no-results"},slot:"no-results"},[t._v("No results found")])])]],2)],1),e("wound-photos",{attrs:{albums:t.albums,"current-album":t.currentAlbum,"selected-patient-id":t.selectedPatientId},on:{"update:currentAlbum":function(e){t.currentAlbum=e},"update:current-album":[function(e){t.currentAlbum=e},t.updateCurrentAlbum]}})],1)],1),e("ImagePopup",{key:`imgpop-${t.popImgKey}`,attrs:{visible:t.imageDialog,image:t.imageSrc},on:{close:t.closeImagePopup}})],1)},w=[],x=(s(4114),s(4335)),D=s(5056),E=s(4573),$=s(5353),z={components:{ImagePopup:D.A,WoundPhotos:E.A},created(){this.initPatientsList()},data(){return{preloading:!0,username:"使用者",thumb_avatar:"",searchQuery:"",imageDialog:!1,imageSrc:"",popImgKey:1,patients:[],patientCount:0,currentPage:1,pageSize:1,infiniteId:+new Date,pinnedPatients:[],selectedPatientId:-1,highlightedPatientId:null,albums:[],currentAlbum:0}},computed:{filteredPatients(){return this.patients.filter((t=>t.user_name.includes(this.searchQuery)||t.user_id.toString().includes(this.searchQuery)))}},methods:{openImagePopup(t){console.log("openImagePopup",t),this.imageSrc=t,this.imageDialog=!0,this.popImgKey+=1},closeImagePopup(){this.imageDialog=!1,this.imageSrc="",this.popImgKey+=1},initPatientsList(){x.A.put("http://127.0.0.1:8000/api/chat/room",{user_id:this.userProfile.id,page:this.currentPage,size:this.pageSize}).then((t=>{console.log(t.data.results),t.data.results.length?(this.patients.push(...t.data.results),this.patientCount=t.data.count,this.currentPage+=1,this.preloading=!1):this.preloading=!0})).catch((t=>{console.error("Error loading more patients:",t),this.updateAlert({show:!0,status:"error",message:"Opps! Something Wrong"}),this.preloading=!1}))},loadMorePatients(t){this.preloading||(console.log("Loading more patients..."),x.A.put("http://127.0.0.1:8000/api/chat/room",{user_id:this.userProfile.id,page:this.currentPage,size:this.pageSize}).then((e=>{console.log(e.data.results),e.data.results.length?(this.patients.push(...e.data.results),this.patientCount=e.data.count,this.currentPage+=1,t.loaded()):t.complete()})).catch((e=>{console.error("Error loading more patients:",e),this.updateAlert({show:!0,status:"error",message:"Opps! Something Wrong"}),t.complete()})))},togglePin(t){const e=!t.pin;t.pin=e,x.A.put("http://127.0.0.1:8000/api/chat/update_pin",{user_id:this.userProfile.id,pin:e,room_path:t.room_path}).then((()=>{this.startReloadPatientData()})).catch((t=>{console.error("Error updating pin state:",t)}))},async startReloadPatientData(){await this.reloadPatients(),await this.initPatientsList()},reloadPatients(){return new Promise((t=>{this.currentPage=1,this.patients=[],this.preloading=!0,t()}))},selectPatient(t){this.selectedPatientId=t,this.highlightedPatientId=t},updateCurrentAlbum(t){this.currentAlbum=t},goChatroom(t){console.log("goChatroom",t),this.UPDATE_USER_ID(t.user_id);const e=JSON.parse(localStorage.getItem("mackay")||"{}");e.room_path=t.room_path,e.selectedId=t.user_id,localStorage.setItem("mackay",JSON.stringify(e)),this.$router.push({path:`/chat/${t.room_path}`})},...(0,$.PY)(["UPDATE_USER_ID"])},mounted(){this.userProfile.name&&(this.username=this.userProfile.name),this.userProfile.thumb&&(this.thumb_avatar=this.userProfile.thumb)}},Q=z,R=s(845),U=(0,R.A)(Q,k,w,!1,null,"f08f5a46",null),O=U.exports},4441:function(t,e,s){t.exports=s.p+"img/user.c1d1a307.png"}}]);
//# sourceMappingURL=618.26100169.js.map