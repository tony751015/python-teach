{"version":3,"file":"css/app.af2ee97f.css","mappings":"AA8PA,KACA,kBACA,CAMA,aACA,eACA,SACA,cACA,OACA,QACA,YACA,WACA,CAEA,kBACA,wBACA,CAEA,YACA,wBACA,CAEA,aACA,wBACA,CAEA,YACA,wBACA,CAEA,kBACA,wBACA","sources":["webpack://wound-chat/./src/App.vue"],"sourcesContent":["<template>\r\n  <v-app>\r\n    <v-alert class=\"login-alert\"\r\n      v-if='alert.show'\r\n      dense\r\n      transition=\"scale-transition\"\r\n      :value=\"alert_timeout\"\r\n      :type=\"alert.status\"> {{ alert.message }}\r\n    </v-alert>\r\n      \r\n    \r\n    <!-- <v-app-bar\r\n      app\r\n      color=\"primary\"\r\n      dark\r\n    >\r\n      <div class=\"d-flex align-center\">\r\n        <v-img\r\n          alt=\"Vuetify Logo\"\r\n          class=\"shrink mr-2\"\r\n          contain\r\n          src=\"https://cdn.vuetifyjs.com/images/logos/vuetify-logo-dark.png\"\r\n          transition=\"scale-transition\"\r\n          width=\"40\"\r\n        />\r\n\r\n        <v-img\r\n          alt=\"Vuetify Name\"\r\n          class=\"shrink mt-1 hidden-sm-and-down\"\r\n          contain\r\n          min-width=\"100\"\r\n          src=\"https://cdn.vuetifyjs.com/images/logos/vuetify-name-dark.png\"\r\n          width=\"100\"\r\n        />\r\n      </div>\r\n\r\n      <v-spacer></v-spacer>\r\n\r\n      <v-btn\r\n        href=\"https://github.com/vuetifyjs/vuetify/releases/latest\"\r\n        target=\"_blank\"\r\n        text\r\n      >\r\n        <span class=\"mr-2\">Latest Release</span>\r\n        <v-icon>mdi-open-in-new</v-icon>\r\n      </v-btn>\r\n    </v-app-bar> -->\r\n\r\n    <v-main>\r\n      <router-view/>\r\n    </v-main>\r\n  </v-app>\r\n</template>\r\n\r\n\r\n<script>\r\n// import { mapMutations, mapGetters } from 'vuex';\r\nimport * as jwt_decode from 'jwt-decode';\r\n\r\nexport default {\r\n  name: 'App',\r\n\r\n  data: () => ({\r\n    alertShow: false,\r\n    alertStatus: '',\r\n    alert_timeout: true,\r\n    timer: '',\r\n  }),\r\n\r\n  created() {\r\n  \r\n    // console.log('this.$route.name', this.$route.name);\r\n    // if (this.$route.name.match(/chat-/g) && !this.$route.query.code && !this.$route.query.state) {\r\n    //   this.detectAutoLoginProcess();\r\n    // }\r\n  },\r\n\r\n  mounted() {\r\n    console.log('this.$route', this.$route);\r\n    console.log('this.$route.name', this.$route.name);\r\n    // if (this.$route.query.code && this.$route.query.state&& this.$route.name === 'woundLogin') {\r\n      // console.log('AAAAAAAAAA1: ', this.$route.name);\r\n    // const url = new URL(\"http://127.0.0.1:3000/\");\r\n    // const loginPage = url.href;\r\n    // console.log('loginPage', loginPage);\r\n    // console.log('URL', location.href.code);\r\n    // if (loginPage === location.href && location.href.code && location.href.state) {\r\n    //   // this.detectAutoLoginProcess();\r\n    //   alert('reline callback')\r\n      \r\n    //   const LoginProcess = new Promise((resolve) => {\r\n    //     const done = this.userLoginProcess(this.$route.query.code, this.$route.query.state);\r\n    //     if (done) {\r\n    //       return resolve({\r\n    //         status: 'ok',\r\n    //         value: true,\r\n    //       });\r\n    //     }\r\n    //   })\r\n\r\n    //   LoginProcess.then((value) => {\r\n    //     if (value.status === 'ok') {\r\n    //       alert('test ok')\r\n    //       // this.activeKey += 1 ;\r\n    //       // this.preloading = value.value;\r\n    //       console.log('LOGIN STATUS END: ', this.userLogin);\r\n    //     }\r\n    //   });\r\n    //   return;\r\n    // } \r\n    this.checkURL(location.href);\r\n    // this.initializeApp().then(() => {\r\n    //     this.autoRelogin();\r\n    // });\r\n  },\r\n  \r\n  \r\n  methods: {\r\n    checkURL(url) {\r\n      try {\r\n        const urlObj = new URL(url);\r\n\r\n        // 檢查 domain 和 pathname，確保沒有任何路徑、字元或 query parameters\r\n        if (urlObj.origin !== 'http://127.0.0.1:8000' && urlObj.pathname !== '/') {\r\n          // return '網址不符合：必須是 https://domain.com 或 https://domain.com/';\r\n          this.autoRelogin();\r\n        }\r\n        alert('網址符合條件');\r\n        return '網址符合條件';\r\n\r\n      } catch (error) {\r\n        return '網址格式錯誤';\r\n      }\r\n    },\r\n    detectAutoLoginProcess() {\r\n      const getJWT = localStorage.getItem('mackay');\r\n      const getJWTData = JSON.parse(localStorage.getItem('mackay'));\r\n\r\n      console.log('getJWTData_id', getJWTData.user_id);\r\n      if (getJWT) {\r\n        // alert('JWT存在');\r\n        // console.log('JWT content: ', getJWT)\r\n        const decoded = jwt_decode(getJWT);\r\n        const { exp } = decoded;\r\n        // const iat = Number(decoded.iat);\r\n        const dateNow = Date.now() / 1000;\r\n        console.log('JWT content: ', decoded)\r\n     \r\n        if (exp - dateNow > 0) {\r\n          const USER_PROFILE = {\r\n            name: decoded.name,\r\n            line_id: decoded.sub,\r\n            thumb: decoded.picture,\r\n          }\r\n\r\n          this.updateUserProfile(USER_PROFILE);\r\n          this.updateUserId(getJWTData.user_id);\r\n          this.updateUserLogin(true);\r\n          this.updateAlert({\r\n            show: true,\r\n            status: 'success',\r\n            message: 'Login ok!'\r\n          });\r\n        }\r\n        this.$router.push('/chat/'+getJWTData.user_id);\r\n      } else {\r\n        // alert('JWT不存在');\r\n        this.updateUserProfile({});\r\n        this.updateUserLogin(false);\r\n        this.updateAlert({\r\n          show: true,\r\n          status: 'error',\r\n          message: 'Please log in again!'\r\n        });\r\n\r\n        this.$router.push({\r\n          name: 'woundLogin'\r\n        })\r\n      }\r\n      // setTimeout(() => {\r\n      //   this.alert_timeout = false;\r\n      //   console.log('alert_timeout', this.alert_timeout);\r\n      // },3000);\r\n    },\r\n    \r\n    // detectAutoLoginProccess() {\r\n    //   const getJWT = localStorage.getItem('mackay');\r\n\r\n    //   if (getJWT) {\r\n    //     // const JWT = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2FjY2Vzcy5saW5lLm1lIiwic3ViIjoiVTk4Y2Q2NTIxMjk3YzVhNzE0MzcyYWFiZWZhZWY1YmM5IiwiYXVkIjoiMjAwNjQ2MjAyNiIsImV4cCI6MTcyOTgyNzIwMywiaWF0IjoxNzI5ODIzNjAzLCJub25jZSI6ImhlbGxvV29ybGQiLCJhbXIiOlsibGluZXNzbyJdLCJuYW1lIjoi5ZGo5a2Q5aCvIFZpY3RvciIsInBpY3R1cmUiOiJodHRwczovL3Byb2ZpbGUubGluZS1zY2RuLm5ldC8waEJBclpMOTBlSFc1UEl3anZEcVZpT1hObUV3TTREUnNtTnhKYURqb2dGbHhnUmxrX2Uwd0ZDMjUwRkFsa1FROXJJUmRXQ1RseEZBNHcifQ.fDIzyGerYXRTI_B17ZbNI1m29GZFKehM0V6IAKztWPM';\r\n  \r\n    //     // const accessToken = JSON.parse(JWT);\r\n    //     const decoded = jwt_decode(getJWT);\r\n    //     const { exp } = decoded;\r\n    //     const iat = Number(decoded.iat);\r\n    //     const dateNow = Date.now() / 1000;\r\n\r\n    //     console.log('JWT content: ', decoded)\r\n  \r\n    //     if (exp - dateNow > 0) {\r\n    //       console.log('JWT令牌在免驗證時間內，不做任何事 | Exp:', (exp), 'Iat:', (iat), 'Count', (iat - exp), );\r\n\r\n    //       const USER_PROFILE = {\r\n    //         name: decoded.name,\r\n    //         line_id: decoded.sub,\r\n    //         thumb: decoded.picture,\r\n    //       }\r\n    //       this.updateUserProfile(USER_PROFILE);\r\n\r\n    //     } else {\r\n    //       console.log('JWT令牌過期了，強制登出 | Exp:', (exp), 'Iat:', (iat), 'Count', (iat - exp));\r\n    //       // localStorage.removeItem('mackay');\r\n    //     }\r\n    //   }\r\n    // }\r\n    \r\n    async initializeApp() {\r\n        // 假設有一些異步操作需要完成\r\n        const mackayData = await this.loadLocalStorageData();\r\n        console.log('LocalStorage 已加載:', mackayData);\r\n    },\r\n\r\n    loadLocalStorageData() {\r\n        return new Promise((resolve) => {\r\n            const data = localStorage.getItem('mackay');\r\n            resolve(data);\r\n        });\r\n    }\r\n  },\r\n  watch: {\r\n    'alert.show'(newVal) {\r\n      if (newVal) {\r\n        this.alert_timeout = true;\r\n        setTimeout(() => {\r\n          this.alert_timeout = false;\r\n          this.updateAlert({\r\n            show: false,\r\n            status: '',\r\n            message: ''\r\n          });\r\n        }, 3000);\r\n      }\r\n    },\r\n  },\r\n  \r\n  // computed: {\r\n  //   ...mapGetters({\r\n  //     getUserProfile: 'exportUserProfile',\r\n  //   }),\r\n  // },\r\n};\r\n</script>\r\n\r\n<style>\r\n.row {\r\n  margin: 0 !important;\r\n}\r\n\r\n.v-dialog {\r\n  /* v-dialog樣式寫在這裡。 */\r\n}\r\n\r\n.login-alert{\r\n  position: fixed;\r\n  top: 50px;  \r\n  z-index: 10000;\r\n  left: 0;\r\n  right: 0;\r\n  width: 200px;\r\n  margin: auto;\r\n}\r\n\r\n.font-super-small {\r\n  font-size: 10px !important;\r\n}\r\n\r\n.font-small {\r\n  font-size: 12px !important;\r\n}\r\n\r\n.font-normal {\r\n  font-size: 14px !important;\r\n}\r\n\r\n.font-large {\r\n  font-size: 16px !important;\r\n}\r\n\r\n.font-super-large {\r\n  font-size: 18px !important;\r\n}\r\n</style>\r\n"],"names":[],"sourceRoot":""}